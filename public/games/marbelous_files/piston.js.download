pc.script.attribute('timeOffset', 'number', 0, {
    min: 0,
    max: 5,
    step: 0.05,
    decimalPrecision: 2
});

pc.script.create('piston', function (app) {
    // Creates a new Piston instance
    var Piston = function (entity) {
        this.entity = entity;
    };

    Piston.prototype = {
        // Called once after all resources are loaded and before the first update
        initialize: function () {
            this.start = false;
            this.pos1 = 0.41;
            this.pos2 = 0;
            this.plate = this.entity.findByName('walk');
            this.grip = this.entity.findByName('extendoGrip');
        },

        // Called every frame, dt is time in seconds since last update
        update: function (dt) {
            this.timeOffset -= dt;
            if(this.timeOffset <= 0){
                this.start = true;
            }
            if(this.start === true){
                if(this.move === true){
                    this.pos1 += 0.005;
                    this.pos2 += 0.005;
                    this.plate.setLocalPosition(0,0,this.pos1);
                    this.grip.setLocalPosition(0,0,this.pos2);
                    this.plate.rigidbody.syncEntityToBody();
                    this.grip.rigidbody.syncEntityToBody();
                }
                if(this.move === false){
                    this.pos1 -= 0.005;
                    this.pos2 -= 0.005;
                    this.plate.setLocalPosition(0,0,this.pos1);
                    this.grip.setLocalPosition(0,0,this.pos2);
                    this.plate.rigidbody.syncEntityToBody();
                    this.grip.rigidbody.syncEntityToBody();
                }
            }
            if(this.pos2 <= 0.01){
                this.move = true;
            }
            if(this.pos2 >= 0.8){
                this.move = false;
            }
        }
    };

    return Piston;
});